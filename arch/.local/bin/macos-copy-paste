#!/usr/bin/env bash
# macOS-style copy/paste: Mod+C/V works everywhere, including terminals
# Usage: macos-copy-paste copy|paste

action="${1:-}"

if [[ -z "$action" ]]; then
    echo "Usage: macos-copy-paste copy|paste" >&2
    exit 1
fi

# Small delay to ensure modifier keys are released
sleep 0.05

# Get focused window app_id
app_id=$(niri msg --json focused-window 2>/dev/null | jq -r '.app_id // ""')

# List of terminal app_ids (add more as needed)
terminals="ghostty|com.mitchellh.ghostty|wezterm|org.wezfurlong.wezterm|alacritty|kitty|foot|konsole|gnome-terminal"

if [[ "$app_id" =~ ^($terminals)$ ]]; then
    # Terminal: use Ctrl+Shift+C/V
    case "$action" in
        copy)  wtype -M ctrl -M shift -P c -m shift -m ctrl ;;
        paste) wtype -M ctrl -M shift -P v -m shift -m ctrl ;;
    esac
else
    # Regular app: use Ctrl+C/V
    case "$action" in
        copy)  wtype -M ctrl -P c -m ctrl ;;
        paste) wtype -M ctrl -P v -m ctrl ;;
    esac
fi
