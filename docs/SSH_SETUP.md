# SSH Setup

> [!IMPORTANT] 
> **The SSH setup runs mainly via 1Password which also dynamically generates the SSH config.**
> Check the **SSH setup** note in 1Password.
> - https://developer.1password.com/docs/ssh
> - https://developer.1password.com/docs/ssh/bookmarks#manage-your-ssh-bookmarks
> - https://developer.1password.com/docs/ssh/git-commit-signing

## TODO

- [ ] Capture BC Hosts and save them as 1Password SSH bookmarks

## Getting Started with 1Password SSH

Reference: [Get started with 1Password for SSH](https://developer.1password.com/docs/ssh/get-started)

### Setup Overview
- 1Password desktop app handles SSH agent functionality
- SSH keys are already stored in 1Password vault (GitHub key configured)
- SSH config is dynamically generated by 1Password

### Key Setup Steps

1. **Enable SSH Agent**
   - Open 1Password settings â†’ Developer section
   - Select "Set Up SSH Agent" 
   - Configure authorization preferences (Touch ID, password, etc.)
   - Check "Generate SSH config file with bookmared hosts"

2. **Test Connection**
   ```bash
   ssh -T git@github.com  # Should show authentication success
   ```

## Git Commit Signing

Reference: [Git commit signing with 1Password](https://developer.1password.com/docs/ssh/git-commit-signing)

### Setup
- Git signing is already configured in dotfiles `.gitconfig`
- Works automatically with 1Password SSH agent
- GitHub SSH key is already registered for signing

### Verification
```bash
git log --show-signature -1  # Check if commits are signed
```

## SSH Bookmarks

Reference: [Manage your SSH bookmarks](https://developer.1password.com/docs/ssh/bookmarks)

### Dynamic SSH Config Generation
- 1Password can generate SSH config file from bookmarks
- Eliminates need to manually maintain `~/.ssh/config`
- Bookmarks automatically match SSH keys to specific hosts

### Creating Bookmarks
1. **From SSH Activity Log**
   - Connect to hosts normally via SSH
   - Check 1Password SSH activity log
   - Click "Bookmark" for recent connections

2. **Manual Creation**
   - Edit SSH Key item in 1Password
   - Add URL field: `ssh://hostname` or `ssh://user@hostname:port`

### Current Setup
- BC Hosts should be captured and saved as 1Password SSH bookmarks
- This allows 1Password to dynamically manage the SSH configuration

## Quick Setup Checklist

For new machines:

- [ ] Install 1Password desktop app
- [ ] Enable SSH agent in 1Password settings
- [ ] Test GitHub connection: `ssh -T git@github.com`
- [ ] Verify commit signing: `git log --show-signature -1`
- [ ] Configure 1Password to generate SSH config from bookmarks

## Platform-Specific Notes

### macOS
- SSH agent socket: Auto-configured by 1Password
- Git signing program: `/Applications/1Password.app/Contents/MacOS/op-ssh-sign`

### Linux  
- SSH agent socket: Auto-configured by 1Password (path varies)
- Git signing program: `/usr/bin/op-ssh-sign` (verify with `which op-ssh-sign`)

### All Platforms
- Keep 1Password running for continuous SSH agent functionality
- Authorization prompts appear on first connection per session
- SSH config can be dynamically generated from 1Password bookmarks
