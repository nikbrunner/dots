# Multiplexer keybindings for tmux (matches WezTerm keymaps-multiplexer.lua)

# Vim integration
IS_VIM="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?|fzf)(diff)?$'"

# Display popups
bind -n M-g display-popup -d "#{pane_current_path}" -w95% -h95% -E "lazygit"
bind -n M-d display-popup -d "#{pane_current_path}" -w95% -h95% -E "lazydocker"
bind -n M-m display-popup -d "#{pane_current_path}" -w90% -h90% -E "rmpc"
bind -n M-T display-popup -d "#{pane_current_path}" -w50% -h35% -B -E "dots theme"
bind -n M-F display-popup -d "#{pane_current_path}" -w50% -h35% -B -E "dots font"

# Application Integration (CTRL - vim navigation)
bind-key -n C-h if-shell "$IS_VIM" "send-keys C-h"  "select-pane -L"
bind-key -n C-j if-shell "$IS_VIM" "send-keys C-j"  "select-pane -D"
bind-key -n C-k if-shell "$IS_VIM" "send-keys C-k"  "select-pane -U" 
bind-key -n C-l if-shell "$IS_VIM" "send-keys C-l"  "select-pane -R"
bind-key -n C-\\ if-shell "$IS_VIM" "send-keys C-\\" "select-pane -l"

# Projects & Workspaces (Sessions in tmux)
bind -n M-S display-popup -w35% -h35% -B -E "repos open"
bind -n M-s choose-tree -s
bind -n M-o switch-client -l

# Session selection
bind -n M-) run-shell "repos open nikbrunner/dots"

bind -n M-! run-shell "repos open nikbrunner/notes"
bind -n M-@ run-shell "repos open nikbrunner/dcd-notes"
bind -n M-# run-shell "repos open nikbrunner/scarth-johnson"

bind -n M-$ run-shell "repos open black-atom-industries/core"
bind -n M-% run-shell "repos open black-atom-industries/nvim"
bind -n M-^ run-shell "repos open black-atom-industries/radar.nvim"

bind -n M-& run-shell "repos open dealercenter-digital/bc-desktop-client"
bind -n M-* run-shell "repos open dealercenter-digital/bc-desktop-tools"
bind -n M-( run-shell "repos open dealercenter-digital/bc-web-client-poc"

# Window Selection Alt-Shift-<number>
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

bind -n M-h previous-window
bind -n M-l next-window
bind -n M-c new-window -c '#{pane_current_path}'
bind -n M-x kill-window

# Pane Management (Splits) - Alt+Shift (using uppercase for tmux compatibility)
bind l split-window -h -c '#{pane_current_path}'
bind j split-window -v -c '#{pane_current_path}'

# Window Movement (equivalent to MoveTabRelative)
bind -n M-, swap-window -t -1 \; previous-window
bind -n M-. swap-window -t +1 \; next-window

bind -n M-S-Left resize-pane -L 5
bind -n M-S-Down resize-pane -D 5
bind -n M-S-Up resize-pane -U 5
bind -n M-S-Right resize-pane -R 5
bind -n M-z resize-pane -Z

bind -n M-x kill-pane

# Workspace Navigation (Session switching)
# bind -n M-j switch-client -n
# bind -n M-k switch-client -p

# Naming (using LEADER prefix)
bind n command-prompt -p "Rename window:" "rename-window '%%'"
bind N command-prompt -p "Rename session:" "rename-session '%%'"

